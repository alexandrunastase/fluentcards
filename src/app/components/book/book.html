<div class="book">
  <div class="navbar navbar-light navbar-full book__nav">
    <div class="container">
      <nav class="nav nav-inline">
        <span class="navbar-brand"><img src="./logo.svg" alt="▯▯▯" height="16" /></span>
        <a class="nav-link" [routerLink]="[ '/' ]">Back to books</a>
        <a class="nav-link pull-right" href="https://github.com/katspaugh/kindle-flashcards-browser/issues">Having an issue?</a>
      </nav>
    </div>
  </div>

  <div class="book__header container">
    <img *ngIf="book.cover" [src]="book.cover"
         class="book__cover pull-left"
         alt="{{ book.title }} cover" />

    <h4 class="book__title">
      {{ book.title }}<br />
      <small>by <em>{{ book.authors }}</em></small>
    </h4>

    <p class="book__count">
      {{ book.count }}&nbsp;{{ book.count == 1 ? 'word' : 'words' }}
    </p>
  </div>

  <div class="container-fluid">
    <div class="book__controls row">
      <div class="col-lg-6 col-md-12 book__control">
        <label>Choose your native language:&nbsp;
          <select class="c-select" [(ngModel)]="language" (ngModelChange)="onLanguageSelect($event)">
            <option value="en">English</option>
            <option value="es">Español</option>
            <option value="fr">Français</option>
            <option value="de">Deutsch</option>
            <option value="ru">Русский</option>
          </select>

          &nbsp;and&nbsp;
        </label>

        <button class="btn btn-primary-outline" (click)="addTranslations()" [disabled]="isTranslationLoading">
          <loader [isLoading]="isTranslationLoading"></loader> add translations
          <span [hidden]="!isTranslationLoading">&nbsp;({{ translationProgress }}%)</span>
        </button>
      </div>

      <div class="col-lg-4 col-md-12 book__control">
        <label>Optionally,&nbsp;
          <button class="btn btn-primary-outline" (click)="addCloze()" [disabled]="book.vocabs[0].cloze != null">
            add cloze test
          </button>
        </label>

        <small class="book__help">
          &nbsp;<i class="fa fa-question-circle"></i>
          <a class="text-muted" target="_blank" href="http://ankisrs.net/docs/manual.html#cloze-deletion">What is a <u>cloze test</u>?</a>
        </small>
      </div>

      <div class="col-lg-2 col-md-12 book__control">
        <a class="btn btn-success-outline" download="{{ book.title }}" [href]="exportUrl">
          Download as CSV
        </a>

        <small class="book__help">
          &nbsp;<i class="fa fa-question-circle"></i>
          <a class="text-muted" target="_blank" href="http://ankisrs.net/docs/manual.html#importing-text-files">How to <u>import it into Anki</u>?</a>
        </small>
      </div>
    </div>

    <div class="container">
      <div class="alert alert-danger" role="alert" [hidden]="!errorMessage">{{ errorMessage }}</div>
    </div>

    <table class="book__table table table-striped">
      <thead>
        <th style="width: 2em">#</th>
        <th style="width: 4em">Picture</th>
        <th width="12%">Word</th>
        <th width="12%" *ngIf="isTranslationLoading || book.vocabs[0].translation != null">Translation</th>
        <th width="70%">Context<span [hidden]="book.vocabs[0].cloze == null"> with cloze deletions</span></th>
      </thead>

      <tbody>
        <tr *ngFor="let vocab of book.vocabs; let i = index">
          <td class="text-muted">{{ i + 1 }}</td>

          <td align="center">
            <img *ngIf="vocab.image" class="book__thumb" [src]="vocab.image.thumbnail"  (click)="addImage(vocab)" />

            <i *ngIf="!vocab.image" class="fa fa-image text-muted book__get-image" (click)="addImage(vocab)"></i>

            <div class="book__images" *ngIf="vocab.isAddingImages">
              <vocab-images [word]="vocab[0]" (onResult)="onImageAdd($event, vocab)"></vocab-images>
            </div>
          </td>

          <td>
            {{ vocab[0] }}
            <i *ngIf="hasSpeechSynthesis" class="fa fa-volume-up text-muted book__speak" (click)="speakWord(vocab[0])"></i>
          </td>

          <td *ngIf="isTranslationLoading || book.vocabs[0].translation != null">
            <span [hidden]="!vocab.translation">{{ vocab.translation }}</span>
            <center [hidden]="vocab.translation"><loader [isLoading]="isTranslationLoading"></loader></center>
          </td>

          <td>{{ vocab.cloze || vocab[2] }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <footer class="navbar navbar-light navbar-full book__nav book__footer">
    <div class="container">
      <nav class="nav nav-inline">
        <span class="nav-link">© 2016 <a href="https://github.com/katspaugh">katspaugh</a></span>
        <span class="nav-link">UI design by <a href="https://dribbble.com/romasketch">Roma</a></span>
        <a class="nav-link" href="https://github.com/katspaugh/kindle-flashcards-browser/issues">Source code on GitHub</a>

        <a class="nav-link pull-right" href="http://translate.yandex.com/">Powered by Yandex.Translate</a>
      </nav>
    </div>
  </footer>
</div>
